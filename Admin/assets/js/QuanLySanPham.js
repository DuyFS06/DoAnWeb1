var danhSachSanPham = [
  {
    id: "SP1",
    name: "Dong ho 1",
    danhMuc: "Thuong hang",
    moTa: "Day la dong ho 1",
    gia: 1000000,
    anh: "../anh/LQ-24B-4B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP2",
    name: "Dong ho 2",
    danhMuc: "Binh dan",
    moTa: "Day la dong ho 2",
    gia: 2000000,
    anh: "../anh/F-91WB-7A.jpg",
    trangThai: "An",
  },
  {
    id: "SP3",
    name: "Dong ho 3",
    danhMuc: "Thuong",
    moTa: "Day la dong ho 3",
    gia: 3000000,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP4",
    name: "Dong ho 4",
    danhMuc: "Binh dan",
    moTa: "Day la dong ho 4",
    gia: 4723123,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "An",
  },
  {
    id: "SP5",
    name: "Dong ho 5",
    danhMuc: "Thuong hang",
    moTa: "Day la dong ho 5",
    gia: 1539922,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP6",
    name: "Dong ho 6",
    danhMuc: "Thuong",
    moTa: "Day la dong ho 6",
    gia: 3249581,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP7",
    name: "Dong ho 7",
    danhMuc: "Binh dan",
    moTa: "Day la dong ho 7",
    gia: 2784930,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "An",
  },
  {
    id: "SP8",
    name: "Dong ho 8",
    danhMuc: "Thuong hang",
    moTa: "Day la dong ho 8",
    gia: 1467276,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP9",
    name: "Dong ho 9",
    danhMuc: "Thuong",
    moTa: "Day la dong ho 9",
    gia: 4027999,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "An",
  },
  {
    id: "SP10",
    name: "Dong ho 10",
    danhMuc: "Thuong hang",
    moTa: "Day la dong ho 10",
    gia: 1893420,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP11",
    name: "Dong ho 11",
    danhMuc: "Binh dan",
    moTa: "Day la dong ho 11",
    gia: 2665017,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "An",
  },
  {
    id: "SP12",
    name: "Dong ho 12",
    danhMuc: "Thuong",
    moTa: "Day la dong ho 12",
    gia: 3581444,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP13",
    name: "Dong ho 13",
    danhMuc: "Thuong hang",
    moTa: "Day la dong ho 13",
    gia: 4152822,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "An",
  },
  {
    id: "SP14",
    name: "Dong ho 14",
    danhMuc: "Thuong",
    moTa: "Day la dong ho 14",
    gia: 2210911,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP15",
    name: "Dong ho 15",
    danhMuc: "Binh dan",
    moTa: "Day la dong ho 15",
    gia: 3856344,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "An",
  },
  {
    id: "SP16",
    name: "Dong ho 16",
    danhMuc: "Thuong hang",
    moTa: "Day la dong ho 16",
    gia: 2548862,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP17",
    name: "Dong ho 17",
    danhMuc: "Thuong",
    moTa: "Day la dong ho 17",
    gia: 4338200,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "An",
  },
  {
    id: "SP18",
    name: "Dong ho 18",
    danhMuc: "Binh dan",
    moTa: "Day la dong ho 18",
    gia: 1168432,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP19",
    name: "Dong ho 19",
    danhMuc: "Thuong hang",
    moTa: "Day la dong ho 19",
    gia: 4956390,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "An",
  },
  {
    id: "SP20",
    name: "Dong ho 20",
    danhMuc: "Thuong",
    moTa: "Day la dong ho 20",
    gia: 3619507,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP21",
    name: "Dong ho 21",
    danhMuc: "Binh dan",
    moTa: "Day la dong ho 21",
    gia: 2841506,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "An",
  },
  {
    id: "SP22",
    name: "Dong ho 22",
    danhMuc: "Thuong",
    moTa: "Day la dong ho 22",
    gia: 1518009,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "Hien thi",
  },
  {
    id: "SP23",
    name: "Dong ho 23",
    danhMuc: "Thuong hang",
    moTa: "Day la dong ho 23",
    gia: 4841620,
    anh: "../anh/MQ-24B-1B.jpg",
    trangThai: "An",
  },
];

console.log("✅ JS file QuanLySanPham.js loaded");
(function initQuanLySanPham() {
  console.log("QuanLySanPham.js loaded");

  const tableContent = document.querySelector(".table-content");
  if (!tableContent) {
    console.warn("Không tìm thấy .table-content — chưa load HTML");
    return;
  }

  function veBangSanPham() {
    tableContent.innerHTML = "";
    let table = document.createElement("table");
    table.classList.add("admin-table");
    let tbody = document.createElement("tbody");

    danhSachSanPham.forEach((sp, index) => {
      let tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${sp.id}</td>
        <td>${sp.name}</td>
        <td>${sp.danhMuc}</td>
        <td>${sp.moTa}</td>
        <td>${sp.gia.toLocaleString("vi-VN")} đ</td>
        <td><img src="${sp.anh}" alt="${
        sp.name
      }" style="width:50px;height:50px;border-radius:5px;"></td>
        <td><input type="checkbox" ${
          sp.trangThai === "Hien thi" ? "checked" : ""
        } disabled></td>
        <td>
          <button class="btn-sua">Sửa</button>
          <button class="btn-xoa">Xóa</button>
        </td>`;
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    tableContent.appendChild(table);
  }

  veBangSanPham();

  const btnThemMoi = document.getElementById("btnThemMoiSP");
  const modal = document.getElementById("modalThemSP");
  const btnClose = document.getElementById("btnCloseModal");
  const btnHuy = document.getElementById("btnHuySP");
  const btnLuu = document.getElementById("btnLuuSP");
  const previewImage = document.getElementById("previewImage");

  function clearModalInputs() {
    modal.querySelectorAll("input, textarea").forEach((el) => (el.value = ""));
    previewImage.innerHTML = "";
  }

  btnThemMoi.addEventListener("click", () => {
    clearModalInputs();
    modal.style.display = "flex";
  });

  btnClose.addEventListener("click", () => {
    modal.style.display = "none";
  });

  btnHuy.addEventListener("click", (e) => {
    e.preventDefault();
    clearModalInputs();
  });

  document.getElementById("anhSPThem").addEventListener("input", (e) => {
    const link = e.target.value.trim();
    previewImage.innerHTML = link
      ? `<img src="${link}" alt="Preview" onerror="this.src='https://via.placeholder.com/400x200?text=Invalid+Image'">`
      : "";
  });

  btnLuu.addEventListener("click", () => {
    const id = document.getElementById("maSPThem").value.trim();
    const name = document.getElementById("tenSPThem").value.trim();
    const moTa = document.getElementById("moTaSPThem").value.trim();
    const danhMuc = document.getElementById("danhMucSPThem").value.trim();
    const gia = Number(document.getElementById("giaSPThem").value);
    const anh = document.getElementById("anhSPThem").value.trim();

    if (!id || !name || !gia || !anh) {
      alert("Vui lòng nhập đầy đủ thông tin!");
      return;
    }

    danhSachSanPham.push({
      id,
      name,
      moTa,
      danhMuc,
      gia,
      anh,
      trangThai: "Hien thi",
    });

    veBangSanPham();
    modal.style.display = "none";
    clearModalInputs();
  });
})();
